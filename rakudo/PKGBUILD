# Maintainer: Andy Weidenbaum <archbaum@gmail.com>

pkgname='rakudo'
pkgver=2020.01
pkgrel=1
pkgdesc='Mature, production-ready implementation of the Raku language'
arch=('aarch64'
      'armv6h'
      'armv7h'
      'i686'
      'x86_64')
depends=('libatomic_ops'
         'libffi'
         'libuv'
         'moarvm'
         'nqp'
         'zstd')
makedepends=('make'
             'perl')
optdepends=('gdb: GDB runner'
            'valgrind: Valgrind runner')
groups=('raku')
url='https://github.com/rakudo/rakudo'
license=('PerlArtistic')
source=("https://github.com/rakudo/rakudo/releases/download/$pkgver/$pkgname-$pkgver.tar.gz"{,.asc})
sha256sums=('2e02fcfca2f79ec6bd2dc0f0840ae108ec76f030f3080aa47f23f80f92b6c3b0'
            'SKIP')
validpgpkeys=('FE750D152426F3E50953176ADE8F8F5E97A8FCDE')
provides=('raku')

build() {
  cd "$srcdir/$pkgname-$pkgver"

  msg2 'Building...'
  perl Configure.pl \
    --prefix='/usr' \
    --backends='moar'
  make
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  msg2 'Installing...'
  export RAKUDO_LOG_PRECOMP=1
  export RAKUDO_RERESOLVE_DEPENDENCIES=0
  make \
    DESTDIR="$pkgdir" \
    install
  install -Dm 755 tools/install-dist.p6 \
    "$pkgdir/usr/bin/raku-install-dist"
}
