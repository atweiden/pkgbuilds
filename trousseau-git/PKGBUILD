# Maintainer: Andy Weidenbaum <archbaum@gmail.com>

pkgname=trousseau-git
pkgver=20150212
pkgrel=1
pkgdesc="Networked and encrypted key-value database"
arch=('any')
depends=('gnome-keyring' 'gnupg')
makedepends=('git' 'go')
url="https://github.com/oleiade/trousseau"
license=('MIT')
source=(git+https://github.com/oleiade/trousseau#branch=develop)
sha256sums=('SKIP')
provides=('trousseau')
conflicts=('trousseau')

pkgver() {
  cd ${pkgname%-git}
  git log -1 --format="%cd" --date=short | sed "s|-||g"
}

build() {
  cd ${pkgname%-git}

  msg2 'Building...'
  # GOPATH="$srcdir" make all
  # GOPATH="$srcdir" TMPDIR=/tmp go get -d github.com/oleiade/trousseau
  # GOPATH="$srcdir" TMPDIR=/tmp go get -d github.com/oleiade/serrure/aes
  # GOPATH="$srcdir" TMPDIR=/tmp go build trousseau.go
  # GOPATH="$srcdir" go get -u github.com/oleiade/trousseau/...

  # see the_platinum_searcher PKGBUILD
  GOPATH="$srcdir" go get -v ./...
}

package() {
  cd ${pkgname%-git}

  msg2 'Installing docs...'
  install -Dm 644 README.md "$pkgdir/usr/share/doc/trousseau/README.md"
  install -Dm 644 CONTRIBUTING.rst \
    "$pkgdir/usr/share/doc/trousseau/CONTRIBUTING.rst"

  msg2 'Installing...'
  install -Dm 755 bin/trousseau "$pkgdir/usr/bin/trousseau"
}
